# SIF/SGF 数据可视化指南

本文档详细说明了所有生成的探索性数据分析（EDA）可视化图表的含义、轴标签、图例和标题解释。

所有图表均在 300 DPI 高分辨率下生成，保存在 `outputs/figures/` 目录中。

---

## 目录

1. [特征分布图](#特征分布图)
2. [标签分布图](#标签分布图)
3. [标签联合分布热力图](#标签联合分布热力图)
4. [分组箱线图](#分组箱线图)
5. [相关性热力图](#相关性热力图)
6. [散点图矩阵](#散点图矩阵)

---

## 特征分布图

**文件名**：`{dataset_name}_feature_distributions.png`

**用途**：展示四个关键物理化学特征在样本中的分布情况。

### 图表组成

该图为 2×2 布局，共 4 个子图，每个子图对应一个特征。

### 子图 1：Molecular Weight (分子量)

**标题**：Molecular Weight (g/mol)

**横轴 (X-axis)**：
- 分子量的数值范围（克/摩尔）
- 单位：g/mol
- 显示样本中观察到的分子量范围

**纵轴 (Y-axis)**：
- 密度（Density）
- 范围：0 到最大密度值
- 表示该分子量范围内样本的相对频率

**图例说明**：
- **蓝色直方图**（Histogram）：样本分子量的频率分布，30 个 bin
- **红色曲线**（KDE）：高斯核密度估计，显示平滑的概率密度分布
- **绿色虚线**（Mean）：平均分子量值及其数值标注
- **橙色虚线**（Median）：中位数分子量值及其数值标注

**统计信息框**（右上角）：
- `N`：样本总数
- `μ`：平均值（mean）
- `σ`：标准差（standard deviation）
- `Skew`：偏度（skewness），>0 表示右偏（长尾在右），<0 表示左偏

**解读建议**：
- 分布是否接近正态（bell curve）或呈现偏态
- 是否存在异常值或长尾
- 样本的集中程度

---

### 子图 2：LogP (脂溶性)

**标题**：LogP (Lipophilicity)

**横轴 (X-axis)**：
- LogP（分配系数的对数）
- 无单位（对数值）
- 范围：通常 -5 到 +10
- 值越大，分子越疏水；值越小，越亲水

**纵轴 (Y-axis)**：
- 密度（Density）
- 表示该 LogP 范围内的相对频率

**图例说明**：同分子量图表
- 蓝色直方图：LogP 分布频率
- 红色 KDE 曲线：平滑概率密度
- 绿色虚线：平均 LogP
- 橙色虚线：中位 LogP

**统计信息框**：
- N、μ、σ、Skew 含义同上

**解读建议**：
- 肽类分子的疏水性分布
- LogP > 5 的分子可能面临溶解度问题
- 偏度反映样本在疏水性上的不平衡

---

### 子图 3：Hydrogen Bond Acceptors (氢键受体)

**标题**：Hydrogen Bond Acceptors

**横轴 (X-axis)**：
- HBA 数量（整数）
- 通常范围：0 到 15+
- 表示分子中的氢键受体原子数（主要为 N、O）

**纵轴 (Y-axis)**：
- 密度（Density）
- 表示具有该数量 HBA 的样本相对频率

**图例说明**：同上
- 直方图显示离散的 HBA 数量分布
- KDE 曲线平滑化这些离散值

**统计信息框**：N、μ、σ、Skew

**解读建议**：
- HBA 过多可能降低膜透过性（Lipinski's Rule of Five: HBA ≤ 10）
- 分布是否集中还是分散

---

### 子图 4：Hydrogen Bond Donors (氢键供体)

**标题**：Hydrogen Bond Donors

**横轴 (X-axis)**：
- HBD 数量（整数）
- 通常范围：0 到 10+
- 表示分子中的氢键供体原子数（主要为 N-H、O-H）

**纵轴 (Y-axis)**：
- 密度（Density）
- 表示具有该数量 HBD 的样本相对频率

**图例说明**：同分子量和 LogP

**统计信息框**：N、μ、σ、Skew

**解读建议**：
- HBD 过多可能降低膜透过性和生物利用度（Lipinski's Rule: HBD ≤ 5）
- 与 HBA 的平衡反映分子的亲疏水平衡

---

## 标签分布图

**文件名**：`{dataset_name}_label_distribution.png`

**用途**：展示 SIF 和 SGF 稳定性标签的分布情况，评估类别平衡问题。

### 图表组成

该图为 1×2 布局，分左右两个子图。

### 左子图：SIF Distribution

**标题**：SIF Distribution

**横轴 (X-axis)**：
- SIF 稳定性等级（0, 1, 2, 3, 4, 5 等）
- 离散的整数值
- 代表不同的稳定性分类

**纵轴 (Y-axis)**：
- Count（样本数量）
- 整数，表示该等级下的样本数量

**图例说明**：
- **蓝色柱子**（steelblue）：每个稳定性等级的样本计数
- **柱子上方的数字**：具体的样本数量

**标题解释**：
- "SIF Distribution" 表示在 **Simulated Intestinal Fluid (小肠模拟液)** 环境中的稳定性分布

**解读建议**：
- 识别类别不平衡：样本在各等级间是否分布不均？
- 某些等级样本过少可能影响模型训练

---

### 右子图：SGF Distribution

**标题**：SGF Distribution

**横轴 (X-axis)**：
- SGF 稳定性等级（0, 1, 2, 3, 4, 5 等）
- 离散的整数值

**纵轴 (Y-axis)**：
- Count（样本数量）
- 整数值

**图例说明**：
- **珊瑚色柱子**（coral）：每个稳定性等级的样本计数
- **柱子上方的数字**：具体的样本数量

**标题解释**：
- "SGF Distribution" 表示在 **Simulated Gastric Fluid (胃液模拟液)** 环境中的稳定性分布

**解读建议**：
- 与 SIF 对比，SGF 的分布是否更不均匀？
- 通常胃环境比小肠更严苛，样本的稳定性评分可能更低

---

## 标签联合分布热力图

**文件名**：`{dataset_name}_label_joint_distribution.png`

**用途**：展示 SIF 和 SGF 稳定性标签的联合分布，揭示两个环境中稳定性的相关性。

### 图表组成

单个二维热力图（heatmap）

### 轴标签

**横轴 (X-axis)**：
- SGF Stability Class（SGF 稳定性等级）
- 整数值：0, 1, 2, 3, 4, 5 等

**纵轴 (Y-axis)**：
- SIF Stability Class（SIF 稳定性等级）
- 整数值：0, 1, 2, 3, 4, 5 等

### 热力图内容

**颜色编码**：
- **亮黄色/浅色**：样本数少（低频）
- **深红/暗色**：样本数多（高频）
- **颜色深度**：与交叉计数成正比（见 cbar 色条）

**数值标注**：
- 每个单元格中的数字表示同时满足该 SIF 等级和 SGF 等级的样本数
- 例如：SIF=1 且 SGF=2 的样本有 N 个

**标题解释**：
- "Joint Distribution of SIF and SGF - {dataset_name}"
- 说明这是 SIF 和 SGF 两维联合分布

**色条 (Colorbar)**：
- 标签：Count
- 表示样本计数的范围

### 解读建议

- **对角线浓度高**：SIF 和 SGF 稳定性等级一致，表示两个环境中的稳定性相关性强
- **非对角线值大**：某些样本在一个环境稳定，在另一个不稳定
- **整体分布偏斜**：某些 (SIF, SGF) 组合更常见

---

## 分组箱线图

**文件名**：`{dataset_name}_grouped_boxplots.png`

**用途**：展示特征值在不同稳定性等级下的分布，揭示特征与稳定性的关系。

### 图表组成

该图为 2×2 布局，4 个子图：

1. 左上：Molecular Weight vs SIF
2. 右上：LogP vs SIF
3. 左下：Molecular Weight vs SGF
4. 右下：LogP vs SGF

---

### 子图 1：Molecular Weight vs SIF

**标题**：Molecular Weight vs SIF

**横轴 (X-axis)**：
- Stability Class（稳定性等级）
- 离散的整数值：1, 2, 3, 4, 5 等
- 表示 SIF 环境中的稳定性分类

**纵轴 (Y-axis)**：
- PC_MolWt（分子量）
- 数值范围取决于数据
- 单位：g/mol

**图例说明**：
- **箱线图（Box-and-Whisker Plot）**：
  - **箱体底部**：第 25 百分位（Q1）
  - **箱体内的线**：中位数（Q2）
  - **箱体顶部**：第 75 百分位（Q3）
  - **须线（Whiskers）**：通常为 [Q1 - 1.5×IQR, Q3 + 1.5×IQR]
  - **点**：异常值（超出须线范围）
- **颜色**（Set2 调色板）：不同等级用不同颜色区分

**标题解释**：
- 展示分子量在不同 SIF 稳定性等级下的分布差异

### 解读建议

- **中位线位置**：不同稳定性等级的分子量中位数是否不同？
- **箱体大小**：某个等级的分子量分散程度是否更大？
- **趋势**：分子量是否与 SIF 稳定性呈现单调关系（如：稳定性越强，分子量越小）？

---

### 子图 2：LogP vs SIF

**标题**：LogP vs SIF

**横轴 (X-axis)**：
- Stability Class（SIF 稳定性等级）

**纵轴 (Y-axis)**：
- PC_LogP（脂溶性）
- 通常范围：-2 到 +8

**图例说明**：箱线图同上

### 解读建议

- **LogP 趋势**：脂溶性是否与 SIF 稳定性相关？
- **离群点**：是否存在高 LogP 但稳定性低的异常样本？

---

### 子图 3：Molecular Weight vs SGF

**标题**：Molecular Weight vs SGF

**横轴 (X-axis)**：
- Stability Class（SGF 稳定性等级）

**纵轴 (Y-axis)**：
- PC_MolWt（分子量）

**图例说明**：同上

### 解读建议

- 与子图 1 对比，SGF 环境下的分子量与稳定性关系是否不同？

---

### 子图 4：LogP vs SGF

**标题**：LogP vs SGF

**横轴 (X-axis)**：
- Stability Class（SGF 稳定性等级）

**纵轴 (Y-axis)**：
- PC_LogP

**图例说明**：同上

### 解读建议

- 与子图 2 对比，SGF 和 SIF 环境中 LogP 与稳定性的关系是否一致？

---

## 相关性热力图

**文件名**：`{dataset_name}_correlation_heatmap.png`

**用途**：展示关键物理化学特征之间的相关性，以及特征与稳定性标签的关系。

### 图表组成

单个相关系数矩阵热力图

### 轴标签

**横轴 (X-axis)** 和 **纵轴 (Y-axis)**：
- 特征名称和标签：
  - `PC_MolWt`：分子量
  - `PC_LogP`：脂溶性
  - `PC_HBA`：氢键受体数
  - `PC_HBD`：氢键供体数
  - `PC_TPSA`：极性表面积（Topological Polar Surface Area）
  - `PC_Rings`：环的数量
  - `PC_RigidityProxy`：刚性指标（环数 / (1 + 旋转键数)）
  - `SIF_class`：SIF 稳定性类别
  - `SGF_class`：SGF 稳定性类别

### 热力图内容

**颜色编码**：
- **蓝色**：负相关（-1 附近）
- **白色**：无相关（0）
- **红色**：正相关（+1 附近）
- **颜色深度**：相关系数的绝对值越大越深

**数值标注**：
- 每个单元格显示具体的相关系数（如 0.53, -0.42 等）
- 范围：-1.00 到 +1.00

**色条 (Colorbar)**：
- 标签：Correlation
- 范围：-1 到 +1

**标题解释**：
- 提示 Pearson 用于特征间，Spearman 用于特征与标签

### 解读建议

- **特征间相关性**：
  - 高相关性的特征对可能存在多重共线性（不适合用于某些模型）
  - 如：MW 和 PC_TPSA 可能正相关（分子大通常极性表面积也大）

- **特征与稳定性的相关性**：
  - 正相关：特征值增加时，稳定性倾向于增加
  - 负相关：特征值增加时，稳定性倾向于降低
  - 接近零：特征与稳定性无线性关系

- **例子**：
  - LogP 与稳定性可能呈负相关（太疏水的分子在胃液中易降解）
  - MW 与稳定性关系可能复杂（既不全是正也不全是负）

---

## 散点图矩阵

**文件名**：`{dataset_name}_scatter_matrix.png`

**用途**：展示关键特征间的多维关系，每个点按 SIF 稳定性等级着色。

### 图表组成

4×4 矩阵布局，共 16 个子图：

- **对角线**：直方图（各特征的单变量分布）
- **非对角线**：散点图（两两特征的二维关系）

特征：`PC_MolWt`、`PC_LogP`、`PC_HBA`、`PC_HBD`

### 对角线子图（直方图）

**标题**：特征名称

**横轴**：特征值
**纵轴**：频率

**图例说明**：
- 蓝色直方图显示单个特征的分布

---

### 非对角线子图（散点图）

**示例**：左上 [行 1, 列 2] = PC_MolWt vs PC_LogP

**横轴**：列特征的值（如 PC_LogP）

**纵轴**：行特征的值（如 PC_MolWt）

**点的含义**：
- **每一个点**代表一个样本
- **点的位置**：(特征1值, 特征2值)
- **点的颜色**：按该样本的 SIF 稳定性等级着色
  - **深紫**（viridis 色图的低值）：SIF_class = 1 或 2（稳定性低）
  - **中等色**：SIF_class = 3（中等稳定性）
  - **黄/亮色**（viridis 的高值）：SIF_class = 4 或 5（稳定性高）

**标题解释**：
- "Scatter Matrix (colored by SIF class) - {dataset_name}"
- 说明整个矩阵是按 SIF 稳定性分类着色的

### 解读建议

- **点的聚集方式**：
  - 同色点聚集在图的某个区域 → 该特征组合与稳定性相关性强
  - 颜色混杂分散 → 该特征组合与稳定性相关性弱

- **线性 vs 非线性**：
  - 点沿直线分布 → 两特征间存在线性关系
  - 点呈曲线或簇 → 可能存在非线性关系或多个样本亚群

- **例子**：
  - MW 和 LogP 的散点可能显示：低 MW 的分子 LogP 倾向于低（亲水的小分子），高 MW 的分子 LogP 倾向于高（疏水的大分子）

---

## 综合解读指南

### 如何整体理解这 6 个图表

1. **特征分布图** → 理解样本的物理化学特性范围和偏态
2. **标签分布图** → 评估类别平衡性和稳定性分级的合理性
3. **标签联合分布** → 理解 SIF 和 SGF 环境中稳定性的关联程度
4. **分组箱线图** → 快速识别哪些特征与稳定性有明显的统计关联
5. **相关性热力图** → 定量理解特征间和特征与标签间的线性相关程度
6. **散点矩阵** → 发现特征间的非线性关系和多维聚集模式

### 典型发现示例

- **如果** LogP 和稳定性呈强负相关 + 分组箱线图显示高 LogP 样本稳定性等级低
  - **结论**：疏水性是影响肽类稳定性的关键因素；过度疏水的设计应避免

- **如果** SIF 和 SGF 联合分布的对角线值最高
  - **结论**：两个模拟液环境中的稳定性判定基本一致

- **如果** MW 分布有明显的多峰性
  - **结论**：数据集可能包含来自不同化学系列的样本；模型训练时考虑分层或加权

---

## 附录：特征名称速查表

| 缩写 | 全称 | 含义 |
|------|------|------|
| PC_MolWt | Molecular Weight | 分子量（g/mol） |
| PC_LogP | LogP | 脂溶性系数（分配系数对数） |
| PC_HBA | Hydrogen Bond Acceptors | 氢键受体数量 |
| PC_HBD | Hydrogen Bond Donors | 氢键供体数量 |
| PC_TPSA | Topological Polar Surface Area | 极性表面积（Ų） |
| PC_Rings | Number of Rings | 环的数量 |
| PC_RigidityProxy | Rigidity Proxy | 刚性指标 |
| SIF_class | SIF Stability Class | 小肠模拟液中的稳定性等级 |
| SGF_class | SGF Stability Class | 胃液模拟液中的稳定性等级 |

---

**生成日期**：2025-11-11  
**图表分辨率**：300 DPI  
**输出格式**：PNG  
**数据来源**：outputs/features/ (NPZ 文件)

