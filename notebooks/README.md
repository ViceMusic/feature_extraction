# SIF/SGF Peptide Stability Notebooks

è¿™ä¸ªç›®å½•åŒ…å«ä¸‰ä¸ªJupyter Notebookï¼Œæä¾›äº†ä»åŸå§‹æ•°æ®åˆ°æ¨¡å‹éªŒè¯çš„å®Œæ•´äº¤äº’å¼å·¥ä½œæµç¨‹ã€‚

## ğŸ“š Notebookæ¦‚è§ˆ

### 1. Phase1_æ•°æ®è½¬åŒ–.ipynb
**ç›®çš„**: å°†åŸå§‹CSVæ•°æ®è½¬æ¢ä¸ºå¯ç”¨äºå»ºæ¨¡çš„ç‰¹å¾çŸ©é˜µ

**ä¸»è¦åŠŸèƒ½**:
- æ•°æ®æ¸…ç†ï¼ˆå¯é€‰ï¼‰
- æ·»åŠ åˆ†å­ç‰¹å¾ï¼ˆå•ä½“/äºŒèšä½“ã€ç¯åŒ–ã€äºŒç¡«é”®æ£€æµ‹ï¼‰
- æ ‡ç­¾è½¬æ¢ï¼ˆæ˜Ÿå·/æ•°å­— â†’ åˆ†é’Ÿï¼‰
- æå–RDKitç‰¹å¾ï¼ˆQEDã€ç‰©ç†åŒ–å­¦æè¿°ç¬¦ã€Morgan/AvalonæŒ‡çº¹ï¼‰
- è´¨é‡éªŒè¯å¯è§†åŒ–

**è¾“å…¥**: `data/raw/*.csv`
**è¾“å‡º**:
- `data/processed/*.csv` (å¸¦åˆ†å­ç‰¹å¾)
- `outputs/features/*.npz` (ç‰¹å¾çŸ©é˜µ)
- `outputs/figures/phase1/*.png` (éªŒè¯å›¾è¡¨)

**é¢„è®¡è¿è¡Œæ—¶é—´**: ~5-10åˆ†é’Ÿï¼ˆå–å†³äºæ•°æ®é›†å¤§å°ï¼‰

---

### 2. Phase2_æ•°æ®å¯è§†åŒ–.ipynb
**ç›®çš„**: æ¢ç´¢æ€§æ•°æ®åˆ†æï¼Œç†è§£æ•°æ®ç‰¹å¾å’Œåˆ†å¸ƒ

**ä¸»è¦åŠŸèƒ½**:
- **ä¸“åˆ©å†…åˆ†æ**: å•ä½“vsäºŒèšä½“ç¨³å®šæ€§å¯¹æ¯”
- **ä¸“åˆ©é—´åˆ†æ**: é™ç»´å¯è§†åŒ–ï¼ˆPCA, t-SNEï¼‰
- æ ‡ç­¾åˆ†å¸ƒå¯¹æ¯”ï¼ˆå°æç´å›¾ã€ç®±çº¿å›¾ï¼‰
- ç»Ÿè®¡æ£€éªŒï¼ˆMann-Whitney U, Kruskal-Wallisï¼‰

**è¾“å…¥**: `data/processed/*.csv`, `outputs/features/*.npz`
**è¾“å‡º**:
- `outputs/figures/phase2/within_patent/` (ä¸“åˆ©å†…å›¾è¡¨)
- `outputs/figures/phase2/between_patents/` (ä¸“åˆ©é—´å›¾è¡¨)

**é¢„è®¡è¿è¡Œæ—¶é—´**: ~3-8åˆ†é’Ÿï¼ˆt-SNEè¾ƒæ…¢ï¼‰

---

### 3. Phase3_æ¨¡å‹éªŒè¯.ipynb
**ç›®çš„**: äºŒåˆ†ç±»å»ºæ¨¡ä¸è¿ç§»å­¦ä¹ è¯„ä¼°

**ä¸»è¦åŠŸèƒ½**:
- æ ‡ç­¾äºŒå€¼åŒ–ï¼ˆåŸºäºä¸­ä½æ•°ï¼‰
- 5æŠ˜äº¤å‰éªŒè¯ï¼ˆLR, RF, XGBoostï¼‰
- ç‰¹å¾é‡è¦æ€§åˆ†æ
- è¿ç§»å­¦ä¹ æµ‹è¯•ï¼ˆè·¨æ•°æ®é›†æ³›åŒ–ï¼‰
- æ€§èƒ½å¯è§†åŒ–ï¼ˆæ··æ·†çŸ©é˜µã€çƒ­åŠ›å›¾ï¼‰

**è¾“å…¥**: `data/processed/*.csv`, `outputs/features/*.npz`
**è¾“å‡º**:
- `outputs/model_results/phase3_binary/cv_results/` (CVç»“æœ)
- `outputs/model_results/phase3_binary/feature_importance/` (ç‰¹å¾é‡è¦æ€§)
- `outputs/model_results/phase3_binary/transfer_results/` (è¿ç§»å­¦ä¹ )
- `outputs/figures/phase3/` (å¯è§†åŒ–å›¾è¡¨)

**é¢„è®¡è¿è¡Œæ—¶é—´**: ~10-30åˆ†é’Ÿï¼ˆå–å†³äºæ˜¯å¦ä½¿ç”¨GPUï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

ç¡®ä¿æ‚¨åœ¨`uv`ç¯å¢ƒä¸­è¿è¡Œï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /path/to/feature_extraction

# åŒæ­¥ä¾èµ–
uv sync

# å¯åŠ¨Jupyter Notebook
uv run jupyter notebook notebooks/
```

æˆ–ä½¿ç”¨JupyterLab:

```bash
uv run jupyter lab notebooks/
```

### ä¾èµ–æ£€æŸ¥

notebooksä¾èµ–ä»¥ä¸‹åº“ï¼ˆå·²åœ¨`pyproject.toml`ä¸­å®šä¹‰ï¼‰:
- pandas, numpy
- rdkit
- matplotlib, seaborn
- scikit-learn, xgboost
- scipy
- tqdm (è¿›åº¦æ¡)

### é¡ºåºæ‰§è¡Œ

**æ¨èæŒ‰é¡ºåºè¿è¡Œ**ï¼š

1. **Phase1_æ•°æ®è½¬åŒ–.ipynb** â†’ ç”Ÿæˆå¤„ç†åçš„æ•°æ®å’Œç‰¹å¾
2. **Phase2_æ•°æ®å¯è§†åŒ–.ipynb** â†’ æ¢ç´¢æ•°æ®ç‰¹å¾
3. **Phase3_æ¨¡å‹éªŒè¯.ipynb** â†’ å»ºæ¨¡å’Œè¯„ä¼°

**ä¹Ÿå¯ä»¥ç‹¬ç«‹è¿è¡Œ**ï¼š
- å¦‚æœå·²æœ‰ `data/processed/` å’Œ `outputs/features/`ï¼Œå¯ä»¥ç›´æ¥è¿è¡ŒPhase 2æˆ–Phase 3

---

## âš™ï¸ é…ç½®å‚æ•°

æ¯ä¸ªnotebookéƒ½æœ‰ä¸€ä¸ª**å‚æ•°é…ç½®åŒº**ï¼ˆç¬¬2ä¸ªä»£ç å•å…ƒæ ¼ï¼‰ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ï¼š

### Phase 1 é…ç½®ç¤ºä¾‹
```python
CONFIG = {
    'raw_dir': project_root / 'data' / 'raw',
    'processed_dir': project_root / 'data' / 'processed',
    'features_dir': project_root / 'outputs' / 'features',
    'figures_dir': project_root / 'outputs' / 'figures' / 'phase1',

    'morgan_bits': 1024,     # MorganæŒ‡çº¹ä½æ•°
    'avalon_bits': 512,      # AvalonæŒ‡çº¹ä½æ•°
    'use_avalon': True,      # æ˜¯å¦ä½¿ç”¨Avalon

    'dpi': 300,              # å›¾åƒåˆ†è¾¨ç‡
    'format': 'png',         # å›¾åƒæ ¼å¼
    'display_plots': True,   # æ˜¯å¦åœ¨notebookä¸­æ˜¾ç¤ºå›¾è¡¨
    'max_display_plots': 3,  # æœ€å¤šæ˜¾ç¤ºå‡ ä¸ªå›¾è¡¨
}
```

### Phase 3 é…ç½®ç¤ºä¾‹
```python
CONFIG = {
    # æ¨¡å‹é€‰æ‹©
    'models_to_train': ['lr', 'rf', 'xgb'],  # å¯é€‰: 'lr', 'rf', 'xgb'

    # CVå‚æ•°
    'n_folds': 5,

    # XGBoost GPUåŠ é€Ÿ
    'use_gpu': True,  # å¦‚æœæœ‰GPU
    'xgb_max_depth': 6,
    'xgb_learning_rate': 0.1,
}
```

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. **é€æ­¥æ‰§è¡Œ**
- ä½¿ç”¨ `Shift + Enter` é€ä¸ªè¿è¡Œå•å…ƒæ ¼
- æ£€æŸ¥æ¯æ­¥çš„è¾“å‡ºï¼Œç¡®ä¿æ•°æ®æ­£ç¡®

### 2. **ä¿®æ”¹å‚æ•°**
- åœ¨é…ç½®åŒºä¿®æ”¹å‚æ•°åï¼Œé‡æ–°è¿è¡Œåç»­å•å…ƒæ ¼
- å¯ä»¥é€‰æ‹©æ€§è¿è¡Œéƒ¨åˆ†åˆ†æï¼ˆå¦‚åªè¿è¡ŒPhase 2çš„ä¸“åˆ©å†…åˆ†æï¼‰

### 3. **ä¿å­˜ä¸­é—´ç»“æœ**
- æ¯ä¸ªnotebookéƒ½ä¼šå°†ç»“æœä¿å­˜åˆ°ç£ç›˜
- å¯ä»¥éšæ—¶é‡å¯kernelï¼Œä»ä¿å­˜çš„æ–‡ä»¶ç»§ç»­

### 4. **å›¾è¡¨æ˜¾ç¤ºæ§åˆ¶**
- è®¾ç½® `display_plots=False` å¯ä»¥åŠ å¿«æ‰§è¡Œé€Ÿåº¦
- æ‰€æœ‰å›¾è¡¨éƒ½ä¼šä¿å­˜åˆ° `outputs/figures/`ï¼Œå¯ä»¥åç»­æŸ¥çœ‹

### 5. **å†…å­˜ç®¡ç†**
- å¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼Œè€ƒè™‘è¿è¡Œå®Œä¸€ä¸ªnotebookåé‡å¯kernel
- æˆ–è€…ä½¿ç”¨ `del` åˆ é™¤ä¸éœ€è¦çš„å¤§å˜é‡

### 6. **GPUåŠ é€Ÿ**ï¼ˆPhase 3ï¼‰
- å¦‚æœæœ‰GPUï¼Œè®¾ç½® `use_gpu=True` å¯ä»¥æ˜¾è‘—åŠ é€ŸXGBoostè®­ç»ƒ
- æ£€æŸ¥GPUå¯ç”¨æ€§ï¼šç¬¬ä¸€ä¸ªä»£ç å•å…ƒæ ¼ä¼šè‡ªåŠ¨æ£€æµ‹

---

## ğŸ“‚ è¾“å‡ºæ–‡ä»¶ç»“æ„

è¿è¡Œå®Œæ‰€æœ‰notebooksåï¼Œè¾“å‡ºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
outputs/
â”œâ”€â”€ features/                      # Phase 1è¾“å‡º
â”‚   â”œâ”€â”€ sif_sgf_second_processed.npz
â”‚   â”œâ”€â”€ US9624268_processed.npz
â”‚   â””â”€â”€ ...
â”œâ”€â”€ figures/
â”‚   â”œâ”€â”€ phase1/                    # Phase 1éªŒè¯å›¾è¡¨
â”‚   â”‚   â”œâ”€â”€ data_filtering_summary.png
â”‚   â”‚   â””â”€â”€ structural_features_distribution.png
â”‚   â”œâ”€â”€ phase2/                    # Phase 2å¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ within_patent/
â”‚   â”‚   â”‚   â”œâ”€â”€ sif_sgf_second/
â”‚   â”‚   â”‚   â””â”€â”€ US9624268/
â”‚   â”‚   â””â”€â”€ between_patents/
â”‚   â”‚       â”œâ”€â”€ pca_2d_by_dataset.png
â”‚   â”‚       â”œâ”€â”€ tsne_2d_by_dataset.png
â”‚   â”‚       â””â”€â”€ label_distribution_violin_plots.png
â”‚   â””â”€â”€ phase3/                    # Phase 3æ¨¡å‹å¯è§†åŒ–
â”‚       â”œâ”€â”€ cv_performance_comparison.png
â”‚       â”œâ”€â”€ transfer_heatmap_SIF_rf.png
â”‚       â””â”€â”€ ...
â””â”€â”€ model_results/
    â””â”€â”€ phase3_binary/
        â”œâ”€â”€ cv_results/            # äº¤å‰éªŒè¯ç»“æœï¼ˆJSONï¼‰
        â”œâ”€â”€ feature_importance/    # ç‰¹å¾é‡è¦æ€§ï¼ˆCSVï¼‰
        â””â”€â”€ transfer_results/      # è¿ç§»å­¦ä¹ ç»“æœï¼ˆJSONï¼‰
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: å¯¼å…¥é”™è¯¯
**ç—‡çŠ¶**: `ModuleNotFoundError: No module named 'feature_extraction'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿åœ¨uvç¯å¢ƒä¸­
uv sync

# å¯åŠ¨notebookæ—¶ä½¿ç”¨uv run
uv run jupyter notebook notebooks/
```

### é—®é¢˜2: RDKit Avalonä¸å¯ç”¨
**ç—‡çŠ¶**: AvalonæŒ‡çº¹ç›¸å…³è­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨é…ç½®åŒºè®¾ç½® `use_avalon=False`
- æˆ–é‡æ–°ç¼–è¯‘RDKit with Avalonæ”¯æŒ

### é—®é¢˜3: GPUä¸å¯ç”¨ï¼ˆXGBoostï¼‰
**ç—‡çŠ¶**: CUDAç›¸å…³é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨Phase 3é…ç½®åŒºè®¾ç½® `use_gpu=False`
- è®­ç»ƒé€Ÿåº¦ä¼šå˜æ…¢ï¼Œä½†ç»“æœä¸€è‡´

### é—®é¢˜4: å†…å­˜ä¸è¶³
**ç—‡çŠ¶**: Kernel died, memory error

**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘`max_display_plots`æ•°é‡
- è®¾ç½® `display_plots=False`
- åˆ†æ‰¹å¤„ç†æ•°æ®é›†ï¼ˆä¿®æ”¹ä»£ç é€‰æ‹©éƒ¨åˆ†æ•°æ®é›†ï¼‰

### é—®é¢˜5: t-SNEè¿è¡Œå¤ªæ…¢
**ç—‡çŠ¶**: Phase 2ä¸­t-SNEå•å…ƒæ ¼é•¿æ—¶é—´è¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘æ ·æœ¬æ•°ï¼ˆéšæœºé‡‡æ ·ï¼‰
- è°ƒæ•´ `tsne_perplexity` å‚æ•°ï¼ˆé»˜è®¤30ï¼‰
- è·³è¿‡t-SNEï¼Œåªè¿è¡ŒPCA

---

## ğŸ†š Notebooks vs Scripts

### ä½•æ—¶ä½¿ç”¨Notebooksï¼Ÿ
âœ… **æ¨èä½¿ç”¨notebookçš„åœºæ™¯**:
- äº¤äº’å¼æ•°æ®æ¢ç´¢å’Œåˆ†æ
- å­¦ä¹ å’Œç†è§£å·¥ä½œæµç¨‹
- è°ƒè¯•å’Œå‚æ•°è°ƒä¼˜
- ç”Ÿæˆæ¼”ç¤ºå’ŒæŠ¥å‘Š
- é€æ­¥æ£€æŸ¥ä¸­é—´ç»“æœ

### ä½•æ—¶ä½¿ç”¨Scriptsï¼Ÿ
âœ… **æ¨èä½¿ç”¨scriptsçš„åœºæ™¯**:
- æ‰¹é‡å¤„ç†å¤§é‡æ•°æ®é›†
- è‡ªåŠ¨åŒ–pipelineï¼ˆcron jobç­‰ï¼‰
- åœ¨è¿œç¨‹æœåŠ¡å™¨åå°è¿è¡Œ
- é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿ
- éœ€è¦è¯¦ç»†æ—¥å¿—æ–‡ä»¶

### å¹¶å­˜å…³ç³»
- **Notebooks**: æä¾›äº¤äº’æ€§å’Œå¯è§†åŒ–ï¼Œé€‚åˆæ¢ç´¢å’Œå­¦ä¹ 
- **Scripts**: æä¾›è‡ªåŠ¨åŒ–å’Œæ‰¹å¤„ç†ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ
- ä¸¤è€…åŠŸèƒ½ä¸€è‡´ï¼Œå¯ä»¥äº’è¡¥ä½¿ç”¨

---

## ğŸ“– è¿›ä¸€æ­¥é˜…è¯»

- **CLAUDE.md**: é¡¹ç›®æ€»ä½“æ–‡æ¡£å’Œscriptsä½¿ç”¨è¯´æ˜
- **docs/dev/**: å„Phaseçš„è¯¦ç»†æŠ¥å‘Š
  - `Phase1_åˆ†å­ç‰¹å¾æå–æŠ¥å‘Š.md`
  - `Phase2_æ•°æ®å¯è§†åŒ–æŠ¥å‘Š.md`
  - `Phase3_æ¨¡å‹éªŒè¯æŠ¥å‘Š.md`
- **docs/Visualization/README.md**: å¯è§†åŒ–è®¾è®¡èƒŒæ™¯

---

## ğŸ“¬ åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æ£€æŸ¥æœ¬READMEçš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„CLAUDE.md
3. æ£€æŸ¥ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ï¼ˆ`*.log`ï¼‰

---

**æœ€åæ›´æ–°**: 2025-11-23
**ç‰ˆæœ¬**: 1.0.0
